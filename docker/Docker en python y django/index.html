
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../03_conceptos_clave/" rel="prev"/>
<link href="../capas/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.1.4" name="generator"/>
<title>Docker en python y django - Sistemas Informáticos</title>
<link href="../../assets/stylesheets/main.240905d7.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.a0c5b2b5.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="green" data-md-color-primary="blue-grey" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#docker-hola-mundo">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Sistemas Informáticos" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Sistemas Informáticos">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Sistemas Informáticos
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Docker en python y django
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="green" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="blue-grey" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="green" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue-grey" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Sistemas Informáticos" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Sistemas Informáticos">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    Sistemas Informáticos
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Obsidian Notes
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Features
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Features
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/LaTeX%20Math%20Support/">
        LaTeX Math Support
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/Mermaid%20Diagrams/">
        Mermaid diagrams
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/Text%20Formatting/">
        Text Formatting
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Topic 1
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Topic 1
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Topic%201/Note%201/">
        Note 1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Topic%201/Note%202/">
        Note 2
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Docker
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Docker
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../00_TOC/">
        00 TOC
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../01_que_es/">
        ¿Qué es Docker y para qué se utiliza? [[1](http://apuntes.ucr.ac.cr/index.php/Docker,_aplicaciones_en_cualquier_parte)]
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02_instalacion/">
        [Instalación de Docker](http://apuntes.ucr.ac.cr/index.php/Docker,_aplicaciones_en_cualquier_parte)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03_conceptos_clave/">
        Conceptos clave
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Docker en python y django
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Docker en python y django
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#docker-hola-mundo">
    Docker, Hola Mundo
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#django-hola-mundo">
    Django, Hola mundo
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pages-app">
    Pages App
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#imagenes-contenedores-y-el-docker-host">
    Imágenes, Contenedores y el "Docker Host"
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../capas/">
        Capas
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../contenedores/">
        Contenedores
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docker_hub/">
        Docker hub
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../gestion_imagenes/">
        Gestion imagenes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../imagenes/">
        Imágenes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../instalacion_del_plugin_en_ZSH/">
        instalacion del plugin en ZSH
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../introduccion/">
        Introducción
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../redes/">
        Redes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../volumenes/">
        Volúmenes
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Docs
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Docs
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../docs/">
        Sistemas Informáticos
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../docs/01_introduccion_sistemas_informaticos/">
        Introducción a los Sistemas Informáticos
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../docs/02_introduccion_sistemas_operativos/">
        Introducción a los Sistemas Operativos
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../docs/03_virtualizacion/">
        Arranque de un Sistema Operativo
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#docker-hola-mundo">
    Docker, Hola Mundo
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#django-hola-mundo">
    Django, Hola mundo
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pages-app">
    Pages App
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#imagenes-contenedores-y-el-docker-host">
    Imágenes, Contenedores y el "Docker Host"
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>Docker en python y django</h1>
<p>Ok, suficiente teoría. Empecemos a usar Docker y Django juntos. El primer paso es registrarse en <a href="https://hub.docker.com/signup">Docker Hub</a> para obtener una cuenta gratuita y luego instalar la aplicación de escritorio Docker en nuestra máquina local:</p>
<ul>
<li><a href="https://docs.docker.com/install/">Docker para Linux</a></li>
<li>Para distribuciones basadas en <a href="https://wiki.archlinux.org/index.php/Docker">Arch</a> será algo tan fácil como ejecutar <code>pacman -S docker</code></li>
<li><a href="https://hub.docker.com/editions/community/docker-ce-desktop-mac">Docker para Mac</a></li>
<li><a href="https://hub.docker.com/editions/community/docker-ce-desktop-windows">Docker para Windows</a></li>
</ul>
<p>Esta descarga puede tomarse algún tiempo ya que es un archivo grande.</p>
<p>Una vez que Docker se haya terminado de instalar, podemos confirmar que se está ejecutando la versión correcta escribiendo <code>docker --version</code> en la línea de comandos. Debe ser al menos la versión 18.</p>
<pre><code class="language-bash">$ docker --version
Docker versión 19.03.5-ce, build 633a0ea838
</code></pre>
<p>Docker se utiliza a menudo con una herramienta adicional, <a href="https://docs.docker.com/compose/">Docker Compose</a>, para ayudar a automatizar los comandos. Docker Compose se incluye con las descargas de Mac y Windows, pero si se está en Linux, tendrá que añadirse manualmente. Puede hacerse ejecutando el comando <code>sudo pip install docker-compose</code> después de que la instalación de Docker haya finalizado.</p>
<ul>
<li>Para distribuciones basadas en <a href="https://wiki.archlinux.org/index.php/Docker">Arch</a> será algo tan fácil como ejecutar <code>pacman -S docker-compose</code>. (Si surgen problemas con algún fichero ya instalado en el sistema, borrar todos aquellos ficheros que estén involucrados y proceder con la instalación como se indica)</li>
</ul>
<h2 id="docker-hola-mundo">Docker, Hola Mundo<a class="headerlink" href="#docker-hola-mundo" title="Permanent link">¶</a></h2>
<p>Docker se envía con su propia imagen de "Hello, World" que es un primer paso útil para comprobar la instalación. Introducir en la línea de comandos el comando <code>docker run hello-world</code>. Esto descargará una imagen Docker oficial y luego se ejecutará dentro de un contenedor. Se discutirá sobre las imágenes y los contenedores en breve.</p>
<pre><code class="language-bash">$ docker run hello-world
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
1b930d010525: Pull complete
Digest: sha256:b8ba256769a0ac28dd126d584e0a2011cd2877f3f76e093a7ae560f2a5301c00
Status: Downloaded newer image for hello-world:latest
Hello from Docker!
This message shows that your installation appears to be working correctly.
To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
(amd64)
 3. The Docker daemon created a new container from that image which runs the executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it to your terminal.
To try something more ambitious, you can run an Ubuntu container with:
$ docker run -it ubuntu bash
Share images, automate workflows, and more with a free Docker ID:
https://hub.docker.com/
For more examples and ideas, visit:
https://docs.docker.com/get-started/
</code></pre>
<p>El comando <code>docker info</code> nos permite inspeccionar Docker. Contendrá una gran cantidad de información, pero si nos centramos en las líneas superiores tenemos 1 contenedor que se detenido y 1 imagen.</p>
<pre><code class="language-bash">$ docker info
Client:
 Debug Mode: false

Server:
 Containers: 1
  Running: 0
  Paused: 0
  Stopped: 1
 Images: 1
...
</code></pre>
<h2 id="django-hola-mundo">Django, Hola mundo<a class="headerlink" href="#django-hola-mundo" title="Permanent link">¶</a></h2>
<p>Ahora vamos a crear un proyecto de Django "Hello, World" que se ejecuta localmente en nuestro ordenador y luego lo moveremos por completo dentro de Docker para que se pueda ver cómo encajan todas las piezas.</p>
<p>El primer paso es elegir una ubicación para nuestro código. Esto puede ser en cualquier parte del ordenador pero si estás en Linux, una ubicación fácil de encontrar es el Escritorio . Desde la línea de comandos navegamos hasta el <code>Escritorio</code> y creamos un directorio <code>code</code> para todos los ejemplos:</p>
<pre><code class="language-bash">$ cd ~/Desktop
$ mkdir code &amp;&amp; cd code
</code></pre>
<p>Luego creeamos un directorio <code>hello</code> donde  instalaremos Django usando Pipenv que crea un archivo Pipfile y un archivo Pipfile.lock.  Activamos el entorno virtual con
el comando <code>shell</code>.</p>
<pre><code class="language-bash">$ mkdir hello &amp;&amp; cd hello
pipenv install django==2.2.7
$ pipenv shell
(hello) $
</code></pre>
<p>Si se necesita ayuda para instalar Pipenv o Python 3, se pueden encontrar más detalles <a href="https://djangoforbeginners.com/initial-setup/">aquí</a>.
Ahora podemos usar el comando <code>startproject</code> para crear un nuevo proyecto de Django llamado <code>hello_project</code>. Añadir un punto, <code>.</code>, al final del comando es un paso opcional pero muchos desarrolladores de Django lo hacen. Sin el punto, Django añade un directorio adicional al proyecto; con el <code>.</code>, esto no ocurre.
Por último, utilice el comando <code>migrate</code> para inicializar la base de datos e iniciar la web local con el comando <code>runserver</code>.</p>
<pre><code class="language-bash">(hola) $ django-admin startproject hello_project .
(hola) $ python manage.py migrate
(hola) $ python manage.py runserver
</code></pre>
<p>Suponiendo que todo ha funcionado correctamente, ahora deberíamos poder navegar para ver el la págica de bienvenida de Django en <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> en su navegador web.</p>
<p><img alt="img01" src="SI23/docs/docker/img/img01.png"/></p>
<h2 id="pages-app">Pages App<a class="headerlink" href="#pages-app" title="Permanent link">¶</a></h2>
<p>Ahora haremos una página de inicio simple creando una <code>pages</code> <strong>app</strong> específica  para ello. Parar el servidor local escribiendo <em>Control+c</em> y luego usar el comando <code>startapp</code> añadiendo el nombre de la <code>pages</code> que se desee.</p>
<pre><code class="language-bash">(hola) $ python manage.py startapp pages
</code></pre>
<p>Django instala automáticamente un nuevo directorio de páginas y varios archivos para nosotros. Pero incluso aunque la app ha sido creada, nuestro <code>hello_project</code> no la reconocerá hasta que la añadamos a la configuración de <code>INSTALLED_APPS</code> de archivo <code>hello_project/settings.py</code>.</p>
<p>Django carga las apps de arriba a abajo, por lo que, en general, es una buena práctica añadir las nuevas aplicaciones debajo de las aplicaciones incorporadas en las que pueden confiar, tales como <code>admin</code>, <code>auth</code>, y todas las aplicaciones restantes.</p>
<p>Téngase en cuenta que si bien es posible simplemente escribir el nombre de la app, <code>pages</code>,  es mejor escribir la <code>pages.apps.apps.PagesConfig</code> completa lo que abre más posibilidades en la configuración de las apps.</p>
<pre><code class="language-python"># hello_project/settings.py
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'pages.apps.apps.PagesConfig', # nuevo
]
</code></pre>
<p>Ahora podemos establecer la ruta URL para la app <code>pages</code>. Ya que queremos que nuestro mensaje aparezca en la página de inicio usaremos la cadena vacía <code>''</code> . No olvidar añadir la importación de <code>include</code> en la segunda línea también.</p>
<pre><code class="language-python"># hello_project/urls.py
from django.contrib import admin
from django.urls import path, include # nuevo

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('pages.urls')), # nuevo
]
</code></pre>
<p>En lugar de crear una plantilla en este punto, podemos simplemente codificar un mensaje en nuestra capa de la vista <code>pages/views.py</code> que producirá la cadena <code>Hello, World!</code>.</p>
<pre><code class="language-python"># pages/views.py
from django.http import HttpResponse

def home_page_view(request):
    return HttpResponse('Hello, World!')
</code></pre>
<p>¿Qué es lo siguiente? El último paso es crear un archivo <code>urls.py</code> dentro de la app <code>pages</code>y enlazarlo to <code>home_page_view</code>. Si se encuentra en un ordenador Mac o Linux, el comando <code>touch</code> se puede usar desde la línea de comandos para crear nuevos archivos. En Windows habrá que crear el nuevo archivo con un editor de texto.</p>
<pre><code class="language-bash">(hola) $ touch pages/urls.py
</code></pre>
<p>En el editor de texto importar <code>path</code> en la primera línea, añadir la <code>home_page_view</code>, y colocar su ruta para otra vez ser la cadena vacía ''. Nótese que también provee un nombre opcional, <code>home</code>, para esta ruta lo cual es una buena práctica.</p>
<pre><code class="language-python"># pages/urls.py
from django.urls import path

from .views import home_page_view


urlpatterns = [
path('', home_page_view, name='home')
]

</code></pre>
<p>El flujo completo de nuestra página web Django es el siguiente:</p>
<ul>
<li>cuando un usuario va a su <em>homepage</em> será primero encaminado a <code>hello_project/urls.py</code></li>
<li>luego a <code>pages/urls.py</code></li>
<li>y finalmente dirigido a la <code>home_page_view</code> que devuelve la cadena <code>Hello, World!</code></li>
</ul>
<p>El trabajo para una página de inicio básica ha terminado. Iniciemos de nuevo el servidor local.</p>
<pre><code class="language-bash">(hola) $ python manage.py runserver
</code></pre>
<p>Si se actualiza el navegador web en http://127.0.0.1:8000/, ahora saldrá nuestro deseado mensaje.</p>
<p><img alt="image02" src="/home/pater/Dropbox/Apuntes/Docker/img/img02.png"/></p>
<p>Ahora es el momento de cambiar a Docker. Detengamos de nuevo el servidor local con <em>Ctrl+C</em> y salgamos de nuestro entorno virtual, que ya no necesitamos, escribiendo <code>exit</code>.</p>
<pre><code class="language-bash">(hello) $ exit
$
</code></pre>
<p>¿Cómo sabemos que nuestro entorno virtual ya no está activo? No habrá un paréntesis alrededor del nombre de directorio en el prompt. Cualquier comando Django normal que se intente ejecutar en este punto fallará. Por ejemplo, probar <code>python manage.py runserver</code> para ver lo que ocurre.</p>
<pre><code class="language-bash">$ python manage.py runserver
File "./manage.py", line 14
  ) from exc
       ^
SyntaxError: invalid syntax
</code></pre>
<p>Esto significa que estamos totalmente fuera del entorno virtual y preparados para Docker.</p>
<h2 id="imagenes-contenedores-y-el-docker-host">Imágenes, Contenedores y el "Docker Host"<a class="headerlink" href="#imagenes-contenedores-y-el-docker-host" title="Permanent link">¶</a></h2>
<p>Una <strong>imagen</strong> Docker es una instantánea en el tiempo de lo que contiene un proyecto. Está representado por un <code>Dockerfile</code> y es literalmente una lista de instrucciones que deben ser construidas/ejecutadas. Un <strong>contenedor</strong> Docker es una instancia en ejecución de una imagen. Para continuar con la analogía de nuestro apartamento de antes, la imagen es el plano o conjunto de planos del apartamento; el contenedor es el edificio real totalmente construido.</p>
<p>El tercer concepto central es el <strong>Docker host</strong>, que es el sistema operativo subyacente. Es posible tener varios contenedores ejecutándose dentro de un mismo <strong>Docker host</strong>. Cuando nos referimos a código o procesos que se ejecutan en el Docker, significa que se ejecutan en el <strong>Docker host</strong>.</p>
<p>Creemos nuestro primer <code>Dockerfile</code> para ver toda esta teoría en acción.</p>
<pre><code class="language-bash">$ touch Dockerfile
</code></pre>
<p>Dentro del <code>Dockerfile</code> agregamos el siguiente código que recorreremos línea por línea más abajo.</p>
<pre><code class="language-Dockerfile"># Pull base image
FROM python:3.8


# Set environment variables
ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1


# Set work directory
WORKDIR /code


# Install dependencies
COPY Pipfile Pipfile.lock /code/
RUN pip install pipenv &amp;&amp; pipenv install --system


# Copy project
COPY . /code/
</code></pre>
<p>Los <code>Dockerfiles</code> se leen de arriba hacia abajo cuando se crea una imagen. La primera instrucción debe ser el comando <code>FROM</code> que nos permite importar una <strong>imagen base</strong> que usar, en nuestro caso <em>Python 3.8</em>.</p>
<p>Luego usamos el comando <code>ENV</code> para establecer dos variables de entorno:</p>
<ul>
<li><code>PYTHONUNBUFFERED</code> asegura que la salida de nuestra consola se vea familiar y que no esté almacenada en un búfer de Docker, lo cual no queremos</li>
<li><code>PYTHONDONTWRITEBYTECODE</code> significa que Python no intentará escribir archivos <code>.pyc</code>, que tampoco deseamos</li>
</ul>
<p>A continuación usamos <code>WORKDIR</code> para establecer una ruta de directorio de trabajo por defecto dentro de nuestra imagen llamada <code>code</code>que es donde guardaremos nuestro código. Si no lo hicimos, entonces cada vez que queramos ejecutar comandos dentro de nuestro contenedor tendríamos que escribir una ruta muy larga. En su lugar, Docker asumirá que queremos ejecutar todos los comandos desde este directorio.</p>
<p>Para nuestras dependencias estamos usando <code>pipenv</code>, así que copiamos tanto el archivo <code>Pipfile</code> como el archivo <code>Pipfile.lock</code> en el directorio <code>/code/</code> en Docker.</p>
<p>Vale la pena tomarse un momento para explicar por qué <code>pipenv</code> crea un <code>Pipfile.lock</code>. El concepto de bloqueo de archivos no es exclusivo de Python o Pipenv; de hecho ya está presente en los gestores de paquetes de los lenguajes de programación más modernos: <code>Gemfile.lock</code> en Ruby, <code>yarn.lock</code> en JavaScript, <code>composer.lock</code> en PHP, etc. Pipenv fue el primer proyecto popular en incorporarlos en la paquetería de Python.</p>
<p>La ventaja de un archivo de bloqueo es que esto conduce a una construcción determinista: no importa cuántas veces se instalen los paquetes de software, se obtendrá el mismo resultado. Sin un fichero <em>lock</em> que "bloquee" las dependencias y su orden, no se cumpliría necesariamente. Lo que significa que dos miembros del equipo que instalan la misma lista de software pueden tener instalaciones de construcción ligeramente diferentes.</p>
<p>Cuando estamos trabajando con Docker donde hay código tanto local en nuestro ordenador como también dentro de Docker, el potencial de conflictos de <code>Pipfile.lock</code> surge cuando se actualizan paquetes de software.</p>
<p>Siguiendo adelante usamos el comando <code>RUN</code> para instalar primero <code>pipenv</code> y luego <code>pipenv install</code> para instalar los paquetes de software listados en nuestro Pipfile.lock, actualmente sólo Django. Es un es importante añadir también el indicador <code>--system</code>, ya que por defecto Pipenv buscará el parámetro en el que instalar cualquier paquete, pero como estamos dentro de Docker ahora, técnicamente no hay ningún entorno virtual. En cierto modo, el contenedor Docker es nuestro entorno virtual y mucho más. Así que debemos usar la bandera <code>--system</code> para asegurarnos de que nuestros paquestes están disponibles en todo el Docker para nosotros.</p>
<p>Como paso final copiamos el resto de nuestro código local en el directorio <code>/code/</code> dentro de Docker. ¿Por qué copiamos el código local dos veces, primero el Pipfile y Pipfile.lock y luego el resto? La razón es que las imágenes se crean en base a instrucciones de arriba hacia abajo por lo que queremos que las cosas que cambian a menudo -como nuestro código local- sea
el último. De esta manera sólo tenemos que regenerar esa parte de la imagen ante un cambio y
no se reinstala todo cada vez que lo haya. Como el software de los paquetes contenidos en nuestros <code>Pipfile</code> y <code>Pipfile.lock</code> cambian con poca frecuencia, implica que no tiene sentido copiarlos e instalarlos antes.</p>
<p>Nuestras instrucciones de imagen ya están hechas, así que vamos a construir la imagen usando el comando <code>docker build .</code>. El punto <code>.</code> indica que el directorio actual es donde se debe ejecutar el comando comando. Se genera una gran cantidad de texto en pantalla; sólo se incluye las dos primeras líneas y las tres últimas.</p>
<pre><code>$ docker build .
Sending build context to Docker daemon 154.1kB
Step 1/7 : FROM python:3.8
...
Step 7/7 : COPY . /code/
---&gt; a48b2acb1fcc
Successfully built a48b2acb1fcc
</code></pre>
<p>Pasando a lo siguiente, ahora necesitamos crear un archivo <code>docker-composition.yml</code> para controlar cómo ejecutar el comando que será construido en base a nuestra imagen de <code>Dockerfile</code>.</p>
<pre><code>$ touch docker-compose.yml
</code></pre>
<p>Contendrá el siguiente código</p>
<pre><code>version: '3.7'

services:
  web:
    build: .
    command: python /code/manage.py runserver 0.0.0.0:8000
    volumes:
      - .:/code
    ports:
      - 8000:8000
</code></pre>
<p>En la línea superior se especifica la versión más reciente de Docker Compose que es actualmente 3.7  (no confundir con la versión de Python que puede ser bien parecida)
A continuación, especificamos qué <code>services</code> (o contenedores) queremos que funcionen en nuestro "Docker host". Es posible tener varios <code>services</code> funcionando, pero por ahora sólo tenemos uno para el servidor <code>web</code>. Especificaremos cómo construir el contenedor diciendo, "Busca el directorio en curso <code>.</code> el <code>Dockerfile</code>" . Luego, dentro del contenedor, ejecute el comando para arrancar el servidor local.
El montaje de los volúmenes sincroniza automáticamente el sistema de archivos Docker con nuestro sistema de archivos local. ¡Esto significa que no tenemos que reconstruir la imagen cada vez que cambiamos un solo fichero!.</p>
<p>Por último especificamos los puertos (<code>ports</code>) a exponer dentro de Docker que solo será el 8000, que es el puerto Django por defecto.</p>
<p>Si es la primera vez que utiliza Docker, es muy probable que se esté muy confundido en este momento. No hay motivo de preocupación. Crearemos múltiples imágenes y contenedores Docker y, con la práctica, el flujo comenzará a tener más sentido. Se verá como se usan archivos <code>Dockerfile</code> y <code>docker-composition.yml</code> muy similares en cada uno de los proyectos.</p>
<p>El paso final es ejecutar nuestro contenedor Docker usando el comando <code>docker-compose up</code>. Este comando resultará en otro largo flujo de texto de salida en la línea de comandos.</p>
<pre><code class="language-bash">$ docker-compose up
Creating network "hello_default" with the default driver
Building web
Step 1/7 : FROM python:3.8
...
Creating hello_web_1 ... done
Attaching to hello_web_1
web_1 | Performing system checks...
web_1 |
web_1 | System check identified no issues (0 silenced).
web_1 | September 20, 2019 - 17:21:57
web_1 | Django version 2.2.5, using settings 'hello_project.settings'
web_1 | Starting development server at http://0.0.0.0:8000/
web_1 | Quit the server with CONTROL-C.
</code></pre>
<p>Para confirmar que realmente funcionó, volveremos a poner <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> en el navegador web. Actualizaremos la página y aparecerá la página "Hello, World".</p>
<p>Django se está ejecutando ahora puramente dentro de un contenedor Docker. No estamos trabajando dentro de un entorno virtual local. No ejecutamos el comando <code>runserver</code>. Todo nuestro código y nuestro servidor Django se está ejecutando desde dentro de un Docker autónomo. !Todo un éxito!</p>
<p>Detendremos el contenedor con <em>Ctrl+C</em> y además escribiremos <code>docker-compose down</code>. Los contenedores absorben una gran cantidad de memoria, así que es una buena idea detenerlos de esta manera cuando hayamos terminado de usarlos.</p>
<p>Los contenedores se han concebido para ser estáticos (no pueden cambiar), por lo que utilizamos <code>volumes</code> para copiar nuestro código en sitios donde si que pueda guardarse.</p>
<pre><code class="language-bash">$ docker-compose down
Removing hello_web_1 ... done
Removing network hello_default
</code></pre>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.19047be9.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</body>
</html>